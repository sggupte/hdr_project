% Segment the images and save them to a new directory
function saveSegmented(filenames, cutoff, numSeg)
    % Make folder called HDR_segmented
    mkdir HDR_Segmented
    
    % Generate the mask
    image = imread(filenames{1});
    mask = uint8(autoSeg(image, numSeg, cutoff));
    
    for filepath = filenames
        % This allows us to label the file and all folders with numbers
        cFilepath = split(filepath,'/');
        lenFilepath = size(cFilepath);
        lenFilepath = lenFilepath(1);
        filename = cFilepath{lenFilepath};
        
        [s,f] = regexp(filename, '(\d+)');
        numerator = filename(s(1):f(1));
        denominator = filename(s(2):f(2));
        newName = strcat('seg_',numerator,'_',denominator,'.tif');
        
        seg_image = mask.*image;
        image = imread(filenames{1})
        
        cd HDR_segmented/
        imwrite(seg_image,newName);
        cd ..
    end
    
end